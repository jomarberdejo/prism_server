// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum ROLE {
  SUPER_ADMIN
  ADMIN
  EDITOR
  VIEWER
}

enum USER_STATUS {
  PENDING
  ACTIVE
  REJECTED
}

enum PPA_STATUS {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  DELAYED
  ARCHIVED
}

model User {
  id               String            @id @default(cuid())
  email            String            @unique
  password         String
  name             String
  role             ROLE              @default(VIEWER)
  isDepartmentHead Boolean           @default(false)
  sessions         Session[]
  departmentHead   ImplementingUnit?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  pushToken        String?
  status           USER_STATUS       @default(PENDING)
  ownedPPAs        PPA[]

  @@index([email])
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique @db.VarChar(240)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
}

model Sector {
  id          String @id @default(cuid())
  name        String
  description String
  PPA         PPA[]
}

model ImplementingUnit {
  id       String @id @default(cuid())
  name     String
  userId   String @unique
  deptHead User   @relation(fields: [userId], references: [id])
  PPA      PPA[]
}

model PPA {
  id                 String           @id @default(cuid())
  task               String
  description        String
  address            String
  venue              String?
  startDate          DateTime
  dueDate            DateTime
  startTime          DateTime
  dueTime            DateTime
  budgetAllocation   String
  approvedBudget     String
  expectedOutput     String
  actualOutput       String?
  remarks            String?
  delayedReason      String?
  sectorId           String
  implementingUnitId String
  sector             Sector           @relation(fields: [sectorId], references: [id])
  implementingUnit   ImplementingUnit @relation(fields: [implementingUnitId], references: [id])
  status             PPA_STATUS       @default(NOT_STARTED)
  lastNotifiedAt     DateTime?
  archivedAt         DateTime?
  userId             String?
  User               User?            @relation(fields: [userId], references: [id])
}
